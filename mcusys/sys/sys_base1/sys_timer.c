/************************************Copyright (c)**************************************
                                          

--------------文件信息------------------------------------------------------------------
文 件 名: SYS_TIMER.c
创 建 人: Zhoucongwen
email:	  mcuast@qq.com
创建日期: 2019年04月15日
描    述: 定时器进程
---------- 版本信息---------------------------------------------------------------------
 版    本: V1.0
 说    明: 
----------------------------------------------------------------------------------------
Copyright(C) C.C. 2019/04/15
All rights reserved
****************************************************************************************/ 
#define SYS_TIMER_MAIN
#include "sys_timer.h"

__weak void usart_1ms_isr(void)
{
	;
}

//*****************************************************************************
__weak void OSIntEnter(void){;}
__weak void OSTimeTick_Int(void){;}
__weak void OSIntExit(void){;}
//1ms中断函数
void mcusys_systick(void)
{
	TIMER_T *p;
	OSIntEnter();			// 进入中断 
	//-----------------------------------------------------
	g_var.cnt_1ms++;							//毫秒计时器
	//-----------------------------------------------------
	//每 1mS 通讯超时判断
	usart_1ms_isr();
	//-----------------------------------------------------
	func_LTB_exec(&g_var.func_ltb_tick);	//1ms中断函数链表
	//-----------------------------------------------------
	p = &g_timer;
	if(++p->div_10ms==10)
	{
		p->div_10ms = 0;
		if(++p->div_qs==25)
		{	//per 25mS
			p->div_qs=0;
			//p->b_flash_250ms = !p->b_flash_250ms;
			b_flash_250ms = !b_flash_250ms;
			
			if(++p->div_1s == 4)
			{
				p->div_1s = 0;
				p->cnt_1s ++;		//秒计时器
			}
		}
	}
	
	//-----------------------------------------------------
	OSTimeTick_Int();			// 调用节拍函数
	//-----------------------------------------------------

	OSIntExit();				// 退出中断 
}
//*****************************************************************************



